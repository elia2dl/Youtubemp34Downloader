import os
import subprocess
from moviepy.editor import *
import time
from sclib import SoundcloudAPI, Track, Playlist
import random

ascii = ["""
             ______                                                   ______                                                             ______                
|``````.   .~      ~.  `.               .' |..          | |         .~      ~.        .'.       |``````.        .'.       `````|`````  .~      ~.  |`````````, 
|       | |          |   `.           .'   |  ``..      | |        |          |     .''```.     |       |     .''```.          |      |          | |'''|'''''  
|       | |          |     `.   .   .'     |      ``..  | |        |          |   .'       `.   |       |   .'       `.        |      |          | |    `.     
|......'   `.______.'        `.' `.'       |          ``| |_______  `.______.'  .'           `. |......'  .'           `.      |       `.______.'  |      `.                                                                                                                                                                 
""", """
    ?????        ??? ? ?? ? ? ???         ???? ?????   ???? ?????      ???  
    ??? ?? ?     ??? ??????????ff??  ?     ?? ?? ??? ?? ?? ?? ???  ?     ?? ??
    ??? ??? ???? ????????????????   ???? ????? ??? ????????  ??.? ???? ???? 
    ??. ?? ???.???????????????????????.???? ?????. ?? ?? ??? ???????.???????
    ??????  ????? ???? ???? ??.???  ????? ?  ? ??????  ?  ?  ???  ?????.?  ?  
    
     
""", """
???????  ??????? ???    ???????   ??????      ???????  ?????? ???????  ?????? ????????? ??????? ??????? 
????????????????????    ????????  ??????     ???????????????????????????????????????????????????????????
???  ??????   ?????? ?? ????????? ??????     ???   ??????????????  ???????????   ???   ???   ???????????
???  ??????   ??????????????????????????     ???   ??????????????  ???????????   ???   ???   ???????????
?????????????????????????????? ??????????????????????????  ??????????????  ???   ???   ????????????  ???
???????  ???????  ???????? ???  ????????????? ??????? ???  ?????????? ???  ???   ???    ??????? ???  ???
    
                                                                                                        
""", """
======================================================================================
====  ===========================  ===================  ==============================
====  ===========================  ===================  ==============================
====  ===========================  ===================  ==========  ==================
====  ===   ===  =   =  ==  = ===  ===   ====   ======  ===   ===    ===   ===  =   ==
==    ==     ==  =   =  ==     ==  ==     ==  =  ===    ==  =  ===  ===     ==    =  =
=  =  ==  =  ===   =   ===  =  ==  ==  =  =====  ==  =  =====  ===  ===  =  ==  ======
=  =  ==  =  ===   =   ===  =  ==  ==  =  ===    ==  =  ===    ===  ===  =  ==  ======
=  =  ==  =  ==== === ====  =  ==  ==  =  ==  =  ==  =  ==  =  ===  ===  =  ==  ======
==    ===   ===== === ====  =  ==  ===   ====    ===    ===    ===   ===   ===  ======
======================================================================================
     
                                                                                                                
""", """
???????  ??????   ?     ??????    ?  ???     ??????   ???      ???????  ???     ????????? ??????   ??????  
???? ???????  ?????? ? ????? ??   ? ????    ????  ?????????    ???? ?????????   ?  ??? ??????  ?????? ? ???
???   ??????  ?????? ? ?????  ?? ???????    ????  ??????  ???  ???   ?????  ??? ? ???? ??????  ?????? ??? ?
????   ????   ?????? ? ??????  ?????????    ???   ???????????? ????   ??????????? ???? ? ???   ??????????  
??????? ? ???????????????????   ????????????? ??????? ??   ???????????  ??   ???? ???? ? ? ??????????? ????
 ???  ? ? ?????? ? ??? ? ? ??   ? ? ? ???  ?? ??????  ??   ???? ???  ?  ??   ???? ? ??   ? ?????? ? ?? ????
 ? ?  ?   ? ? ??   ? ? ? ? ??   ? ??? ? ?  ?  ? ? ??   ?   ?? ? ? ?  ?   ?   ?? ?   ?      ? ? ??   ?? ? ??
 ? ?  ? ? ? ? ?    ?   ?    ?   ? ?   ? ?   ? ? ? ?    ?   ?    ? ?  ?   ?   ?    ?      ? ? ? ?    ??   ? 
   ?        ? ?      ?            ?     ?  ?    ? ?        ?  ?   ?          ?  ?            ? ?     ?     
 ?                                                              ?                                          
""", """
 ;                                                                                           ;                                                       
 ED.              :                                                        :                 ED.                                    :                
 E#Wi            t#,                       L.                             t#,                E#Wi                                  t#,               
 E###G.         ;##W.                      EW:        ,ft            i   ;##W.               E###G.                               ;##W.   j.         
 E#fD#W;       :#L:WE             ;        E##;       t#E           LE  :#L:WE            .. E#fD#W;               .. GEEEEEEEL  :#L:WE   EW,        
 E#t t##L     .KG  ,#D          .DL        E###t      t#E          L#E .KG  ,#D          ;W, E#t t##L             ;W, ,;;L#K;;. .KG  ,#D  E##j       
 E#t  .E#K,   EE    ;#f f.     :K#L     LWLE#fE#f     t#E         G#W. EE    ;#f        j##, E#t  .E#K,          j##,    t#E    EE    ;#f E###D.     
 E#t    j##f f#.     t#iEW:   ;W##L   .E#f E#t D#G    t#E        D#K. f#.     t#i      G###, E#t    j##f        G###,    t#E   f#.     t#iE#jG#W;    
 E#t    :E#K::#G     GK E#t  t#KE#L  ,W#;  E#t  f#E.  t#E       E#K.  :#G     GK     :E####, E#t    :E#K:     :E####,    t#E   :#G     GK E#t t##f   
 E#t   t##L   ;#L   LW. E#t f#D.L#L t#K:   E#t   t#K: t#E     .E#E.    ;#L   LW.    ;W#DG##, E#t   t##L      ;W#DG##,    t#E    ;#L   LW. E#t  :K#E: 
 E#t .D#W;     t#f f#:  E#jG#f  L#LL#G     E#t    ;#W,t#E    .K#E       t#f f#:    j###DW##, E#t .D#W;      j###DW##,    t#E     t#f f#:  E#KDDDD###i
 E#tiW#G.       f#D#;   E###;   L###j      E#t     :K#D#E   .K#D         f#D#;    G##i,,G##, E#tiW#G.      G##i,,G##,    t#E      f#D#;   E#f,t#Wi,,,
 E#K##i          G#t    E#K:    L#W;       E#t      .E##E  .W#G           G#t   :K#K:   L##, E#K##i      :K#K:   L##,    t#E       G#t    E#t  ;#W:  
 E##D.            t     EG      LE.        ..         G#E :W##########Wt   t   ;##D.    L##, E##D.      ;##D.    L##,     fE        t     DWi   ,KK: 
 E#t                    ;       ;@                     fE :,,,,,,,,,,,,,.      ,,,      .,,  E#t        ,,,      .,,       :                         
 L:                                                     ,                                    L:                                                      
""", """
?????????   ????????   ??     ??  ???????    ??        ????????     ????????? ?????????     ?????????     ???      ????????     ????????? 
???   ???? ???    ??? ???     ??? ????????? ???       ???    ???   ???    ??? ???   ????   ???    ??? ??????????? ???    ???   ???    ??? 
???    ??? ???    ??? ???     ??? ???   ??? ???       ???    ???   ???    ??? ???    ???   ???    ???    ???????? ???    ???   ???    ??? 
???    ??? ???    ??? ???     ??? ???   ??? ???       ???    ???   ???    ??? ???    ???   ???    ???     ???   ? ???    ???  ??????????? 
???    ??? ???    ??? ???     ??? ???   ??? ???       ???    ??? ???????????? ???    ??? ????????????     ???     ???    ??? ??????????   
???    ??? ???    ??? ???     ??? ???   ??? ???       ???    ???   ???    ??? ???    ???   ???    ???     ???     ???    ??? ???????????? 
???   ???? ???    ??? ??? ??? ??? ???   ??? ????    ? ???    ???   ???    ??? ???   ????   ???    ???     ???     ???    ???   ???    ??? 
?????????   ????????   ?????????   ??   ??  ?????????  ????????    ???    ??  ?????????    ???    ??     ??????    ????????    ???    ??? 
                                            ?                                                                                  ???    ??? 
                                            
                                            
""", """
      .o8                                         oooo                            .o8                .                      
     "888                                         `888                           "888              .o8                      
 .oooo888   .ooooo.  oooo oooo    ooo ooo. .oo.    888   .ooooo.   .oooo.    .oooo888   .oooo.   .o888oo  .ooooo.  oooo d8b 
d88' `888  d88' `88b  `88. `88.  .8'  `888P"Y88b   888  d88' `88b `P  )88b  d88' `888  `P  )88b    888   d88' `88b `888""8P 
888   888  888   888   `88..]88..8'    888   888   888  888   888  .oP"888  888   888   .oP"888    888   888   888  888     
888   888  888   888    `888'`888'     888   888   888  888   888 d8(  888  888   888  d8(  888    888 . 888   888  888     
`Y8bod88P" `Y8bod8P'     `8'  `8'     o888o o888o o888o `Y8bod8P' `Y888""8o `Y8bod88P" `Y888""8o   "888" `Y8bod8P' d888b                                                                                                                              
                                                                                                                            
                                                                                                        
""",  '''
 ??????   ??????   ????    ????  ???? ??  ??????    ??????   ?????   ??????   ?????   ????????  ??????   ???????? 
? ??   ? ?      ? ?   ?    ?  ? ?  ? ? ? ?    ?    ?      ? ? ?? ?? ? ??   ? ? ?? ?? ?    ?  ? ?      ? ?   ?   ? 
? ?    ? ?      ? ?  ?        ? ?  ?  ?? ?    ?    ?      ?   ????? ? ?    ?   ????? ?   ?     ?      ? ?  ?????  
  ?    ? ??    ??   ?   ?    ?    ?   ?      ?     ??    ??  ??   ?   ?    ?  ??   ?    ?      ??    ??  ??    ?  
 ???????   ????      ??? ?? ??  ??   ?     ????????? ????   ?   ??   ??????? ?   ??   ??         ????   ?     ?   
?     ?                    ?    ?    ?     ?                ?   ?   ?     ?  ?   ?   ?                  ?     ?   
?                               ?          ?                        ?                ?                            
''', '''
 .S_sSSs      sSSs_sSSs     .S     S.    .S_sSSs    S.        sSSs_sSSs     .S_SSSs     .S_sSSs     .S_SSSs    sdSS_SSSSSSbs    sSSs_sSSs     .S_sSSs    
.SS~YS%%b    d%%SP~YS%%b   .SS     SS.  .SS~YS%%b   SS.      d%%SP~YS%%b   .SS~SSSSS   .SS~YS%%b   .SS~SSSSS   YSSS~S%SSSSSP   d%%SP~YS%%b   .SS~YS%%b   
S%S   `S%b  d%S'     `S%b  S%S     S%S  S%S   `S%b  S%S     d%S'     `S%b  S%S   SSSS  S%S   `S%b  S%S   SSSS       S%S       d%S'     `S%b  S%S   `S%b  
S%S    S%S  S%S       S%S  S%S     S%S  S%S    S%S  S%S     S%S       S%S  S%S    S%S  S%S    S%S  S%S    S%S       S%S       S%S       S%S  S%S    S%S  
S%S    S&S  S&S       S&S  S%S     S%S  S%S    S&S  S&S     S&S       S&S  S%S SSSS%S  S%S    S&S  S%S SSSS%S       S&S       S&S       S&S  S%S    d*S  
S&S    S&S  S&S       S&S  S&S     S&S  S&S    S&S  S&S     S&S       S&S  S&S  SSS%S  S&S    S&S  S&S  SSS%S       S&S       S&S       S&S  S&S   .S*S  
S&S    S&S  S&S       S&S  S&S     S&S  S&S    S&S  S&S     S&S       S&S  S&S    S&S  S&S    S&S  S&S    S&S       S&S       S&S       S&S  S&S_sdSSS   
S&S    S&S  S&S       S&S  S&S     S&S  S&S    S&S  S&S     S&S       S&S  S&S    S&S  S&S    S&S  S&S    S&S       S&S       S&S       S&S  S&S~YSY%b   
S*S    d*S  S*b       d*S  S*S     S*S  S*S    S*S  S*b     S*b       d*S  S*S    S&S  S*S    d*S  S*S    S&S       S*S       S*b       d*S  S*S   `S%b  
S*S   .S*S  S*S.     .S*S  S*S  .  S*S  S*S    S*S  S*S.    S*S.     .S*S  S*S    S*S  S*S   .S*S  S*S    S*S       S*S       S*S.     .S*S  S*S    S%S  
S*S_sdSSS    SSSbs_sdSSS   S*S_sSs_S*S  S*S    S*S   SSSbs   SSSbs_sdSSS   S*S    S*S  S*S_sdSSS   S*S    S*S       S*S        SSSbs_sdSSS   S*S    S&S  
SSS~YSSY      YSSP~YSSY    SSS~SSS~S*S  S*S    SSS    YSSP    YSSP~YSSY    SSS    S*S  SSS~YSSY    SSS    S*S       S*S         YSSP~YSSY    S*S    SSS  
                                        SP                                        SP                      SP        SP                       SP          
                                        Y                                         Y                       Y         Y                        Y           
     
                                                                                                                                                                                                                                                                                                             
'''
         ]


def shell():
    os.system("clear")

    while True:
        print(ascii[random.randint(0, len(ascii) - 1)])

        print("1. mp4 (Youtube)")
        print("2. mp3 (Youtube + Soundcloud)")
        print("3. Exit")

        try:
            inp = input()
            if int(inp) == 1:
                os.system("clear")
                print("[+] Incolla il link youtube di una playlist o di una canzone.")
                url = input("")
                os.system("mkdir mp4; cd mp4; youtube-dl -i -f mp4 --yes-playlist --no-check-certificate " + url)
                time.sleep(5)
                os.system("clear")
                print("\n\n\n[+] Tutto fatto!")
                continue
            elif int(inp) == 2:
                os.system("clear")
                print("[+] Incolla il link youtube o soundcloud di una playlist o di una canzone.")
                url = input("")
                if "soundcloud" in url:
                    api = SoundcloudAPI()
                    if "/sets/" in url:
                        playlist = api.resolve(url)
                        for track in playlist.tracks:
                            track_artist = str(track.artist)
                            track_title = str(track.title)
                            if "/" in track_title:
                                track_title = track_title.replace("/", "+")
                            if "/" in track_artist:
                                track_artist = track_artist.replace("/", "+")
                            filename = f'./mp3/{track_artist} - {track_title}.mp3'
                            try:
                                with open(filename, 'wb+') as fp:
                                    try:
                                        track.write_mp3_to(fp)
                                    except Exception as e:
                                        print("[-] {} - {}       non puo essere scaricata".format(track_artist,
                                                                                                  track_title))
                                        continue
                            except OSError as e:
                                filename = f'./mp3/{track.artist} - {track.title[:8]}.mp3'
                                with open(filename, 'wb+') as fp:
                                    track.write_mp3_to(fp)
                        print("[+] Tutto finito!")
                        continue
                    else:
                        track = api.resolve(url)
                        track_artist = str(track.artist)
                        track_title = str(track.title)
                        if "/" in track_title:
                            track_title = track_title.replace("/", "+")
                        if "/" in track_artist:
                            track_artist = track_artist.replace("/", "+")
                        filename = f'./mp3/"{track_artist} - {track_title}.mp3"'
                        try:
                            with open(filename, 'wb+') as fp:
                                try:
                                    track.write_mp3_to(fp)
                                except Exception as e:
                                    print(
                                        "[-] {} - {}       non puo essere scaricata".format(track_artist, track_title))
                                    continue
                        except OSError as e:
                            filename = f'./mp3/{track.artist} - {track.title[:8]}.mp3'
                            with open(filename, 'wb+') as fp:
                                track.write_mp3_to(fp)
                            print("[+] Tutto finito!")
                            continue
                os.system("mkdir mp4; cd mp4; youtube-dl -i -f mp4 --yes-playlist --no-check-certificate " + url)
                time.sleep(5)
                print("[+] Tutto fatto, converto ora i file in mp3")
                foldermp3 = "./mp3/"
                foldermp4 = "./mp4/"
                os.system("mkdir mp3")
                counter = 0
                for file in os.listdir(foldermp4):
                    mp4 = VideoFileClip(foldermp4 + file)
                    mp3 = mp4.audio
                    mp3.write_audiofile(foldermp3 + (file.split(".mp4")[0] + ".mp3"))
                    mp3.close()
                    counter += 1
                if counter == len(os.listdir("mp4")):
                    os.system("clear")
                    os.system("rm -r " + foldermp4)
                    os.system("clear")
                    for file in os.listdir(foldermp3):
                        os.system('mv "{}" "{}"'.format(foldermp3 + str(file), foldermp3 + str(file[:-16] + ".mp3")))
                    print("[+] Tutto finito!")
            elif int(inp) == 3:
                os.system("clear")
                print("Auf wiedersehen!")
                exit()
            else:
                os.system("clear")
                print("Cio che hai digitato non ? incluso nelle possibili scelte.")

        except Exception as e:
            os.system("clear")
            print("[-] Qualcosa ? andato storto, riprova :(")
            continue
if __name__ == "__main__":
    try:
        shell()
    except KeyboardInterrupt:
        print("Aufwiedersehen!")
        exit()
